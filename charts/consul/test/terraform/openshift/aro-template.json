{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location" : {
      "type": "string",
      "metadata": {
        "description": "Location"
      }
    },
    "domain": {
      "type": "string",
      "defaultValue": "[toLower(substring(uniqueString(resourceGroup().id), 0, 8))]",
      "metadata": {
        "description": "Custom Domain Prefix, autogenerated by default"
      }
    },
    "clusterName" : {
      "type": "string",
      "metadata": {
        "description": "Unique name for the cluster"
      }
    },
    "clusterResourceGroupName" : {
      "type": "string",
      "metadata": {
        "description": "ResourceGroup name for the ARO cluster"
      }
    },
    "tags": {
      "type": "string",
      "metadata": {
        "description": "Tags for resources"
      }
    },
    "clientId" : {
      "type": "string",
      "metadata": {
        "description": "The Application ID of an Azure Active Directory client application"
      }
    },
    "clientSecret" : {
      "type":"securestring",
      "metadata": {
        "description": "The secret of an Azure Active Directory client application"
      }
    },
    "workerSubnetId": {
      "type": "string",
      "metadata": {
        "description": "Worker nodes subnet ID"
      }
    },
    "masterSubnetId": {
      "type": "string",
      "metadata": {
        "description": "Master node subnet ID"
      }
    }
  },
  "variables": {
    "tagsObject": "[base64(parameters('tags'))]"
  },
  "resources": [
    {
      "apiVersion": "2020-04-30",
      "type": "Microsoft.RedHatOpenShift/OpenShiftClusters",
      "name": "[parameters('clusterName')]",
      "location": "[parameters('location')]",
      "tags": "[base64ToJson(variables('tagsObject'))]",
      "properties": {
        "clusterProfile": {
          "domain": "[parameters('domain')]",
          "resourceGroupId": "[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', parameters('clusterResourceGroupName'))]"
        },
        "networkProfile": {
          "podCidr": "10.128.0.0/14",
          "serviceCidr": "172.30.0.0/16"
        },
        "servicePrincipalProfile": {
          "clientId": "[parameters('clientId')]",
          "clientSecret": "[parameters('clientSecret')]"
        },
        "masterProfile": {
          "vmSize": "Standard_D8s_v3",
          "subnetId": "[parameters('masterSubnetId')]"
        },
        "workerProfiles": [
          {
            "name": "worker",
            "vmSize": "Standard_D4s_v3",
            "diskSizeGB": 128,
            "subnetId": "[parameters('workerSubnetId')]",
            "count": 3
          }
        ],
        "apiserverProfile": {
          "visibility": "Public"
        },
        "ingressProfiles": [
          {
            "name": "default",
            "visibility": "Public"
          }
        ]
      }
    }
  ]
}
